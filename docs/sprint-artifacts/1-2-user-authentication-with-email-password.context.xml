<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.2</storyId>
    <title>User Authentication with Email/Password</title>
    <status>drafted</status>
    <generatedAt>2025-11-23</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/1-2-user-authentication-with-email-password.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>to be able to sign up and log in with my email and password</iWant>
    <soThat>I can have a secure personal account</soThat>
    <tasks>
      - [ ] **Task 1: Backend API for Email/Password Auth** (AC: #1, #3)
          - [ ] Create `POST /api/v1/auth/signup` endpoint in FastAPI. (Source: `tech-spec-epic-1.md#APIs-and-Interfaces`)
          - [ ] Implement logic to call Supabase Auth to create a new user.
          - [ ] Create `POST /api/v1/auth/login` endpoint in FastAPI. (Source: `tech-spec-epic-1.md#APIs-and-Interfaces`)
          - [ ] Implement logic to call Supabase Auth to sign in a user and return tokens.
          - [ ] Add Pydantic schemas for request/response validation. (Source: `tech-spec-epic-1.md#Services-and-Modules`)
      - [ ] **Task 2: Frontend UI for Signup and Login** (AC: #1, #2, #3)
          - [ ] Create a new page/route for authentication in the Next.js app.
          - [ ] Build the UI form with fields for email and password.
          - [ ] Implement client-side logic to call the backend `/signup` endpoint.
          - [ ] Implement client-side logic to call the backend `/login` endpoint.
          - [ ] On successful login/signup, store session tokens securely and redirect to an authenticated page. (AC: #2)
      - [ ] **Task 3: Testing**
          - [ ] Add Pytest unit tests for the new backend endpoints.
          - [ ] Add React Testing Library tests for the frontend components.
          - [ ] Add a Playwright E2E test for the full email/password signup and login flow.
    </tasks>
  </story>

  <acceptanceCriteria>
    1.  **Given** a user is on the login/signup page, **when** they enter a valid email and password and click "Sign Up", **then** a new user is created in the Supabase `users` table.
    2.  **And** they are automatically logged in.
    3.  **Given** a registered user is on the login page, **when** they enter their correct email and password and click "Log In", **then** they are successfully authenticated.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>ibe160 - Epic Breakdown</title>
        <section>Story 1.2: User Authentication with Email/Password</section>
        <snippet>As a User, I want to be able to sign up and log in with my email and password, so that I can have a secure personal account.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-1.md</path>
        <title>Epic Technical Specification: Core Platform & User Foundation</title>
        <section>APIs and Interfaces</section>
        <snippet>POST /api/v1/auth/signup, POST /api/v1/auth/login</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Authentication</section>
        <snippet>User authentication will be handled by Supabase Auth, supporting email/password and OAuth providers (Google) as defined in the PRD.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing code artifacts found relevant to this story. This story will create the necessary authentication files. -->
    </code>
    <dependencies>
      <ecosystem name="Node">
        <dependency name="@faker-js/faker" version="^10.1.0" type="dev" />
        <dependency name="@playwright/test" version="^1.56.1" type="dev" />
      </ecosystem>
      <ecosystem name="Python">
        <!-- No requirements.txt or pyproject.toml found. Dependencies are defined in architecture documents. -->
        <dependency name="fastapi" version="" type="runtime" />
        <dependency name="uvicorn" version="" type="runtime" />
        <dependency name="python-dotenv" version="" type="runtime" />
        <dependency name="supabase-py" version="" type="runtime" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>User authentication must be handled by Supabase Auth.</constraint>
    <constraint>The API must be RESTful and use JSON for requests and responses.</constraint>
    <constraint>Error handling should follow the defined API contract, using standard HTTP status codes.</constraint>
    <constraint>Data models must align with the schema in architecture.md.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>User Signup</name>
      <kind>REST Endpoint</kind>
      <signature>POST /api/v1/auth/signup</signature>
      <path>backend/app/api/v1/auth.py</path>
    </interface>
    <interface>
      <name>User Login</name>
      <kind>REST Endpoint</kind>
      <signature>POST /api/v1/auth/login</signature>
      <path>backend/app/api/v1/auth.py</path>
    </interface>
  </interfaces>
  <tests>
    <standards>
      Backend unit tests should be written with Pytest. Frontend component tests should use React Testing Library. End-to-end tests for user flows should be implemented with Playwright.
    </standards>
    <locations>
      <location type="E2E">/tests/e2e/</location>
      <location type="Backend">/backend/tests/</location>
      <location type="Frontend">Component-colocated tests or a central /app/tests/ directory.</location>
    </locations>
    <ideas>
      <idea ac_id="1, 3">Write an API test for the `POST /api/v1/auth/signup` and `POST /api/v1/auth/login` endpoints.</idea>
      <idea ac_id="1, 2, 3">Write a UI component test for the login/signup form, testing validation and submission.</idea>
      <idea ac_id="1, 2, 3">Write a full E2E test using Playwright that signs up a new user, logs out, and logs back in.</idea>
    </ideas>
  </tests>
</story-context>
