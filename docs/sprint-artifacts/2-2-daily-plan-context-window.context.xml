<story-context id="2-2-daily-plan-context-window" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2</storyId>
    <title>Daily Plan Context Window</title>
    <status>validated</status>
    <generatedAt>2025-12-12</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-2-daily-plan-context-window.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>a clear and intuitive "Context Window" UI on my dashboard to input my daily mood, energy, and soreness</iWant>
    <soThat>the AI can generate an adaptive and personalized daily workout plan based on my current physical and mental state</soThat>
    <tasks>
        -   [ ] **Task 1: Implement Context Window UI (AC2.2.1)**
            -   [ ] Subtask 1.1: Create a React component for the "Context Window" modal/overlay (`apps/web/src/components/ContextWindow.tsx`).
            -   [ ] Subtask 1.2: Implement segmented button groups for "Mood" (e.g., Stressed, Neutral, Motivated) as per Flow 6, Screen 1 of UX design.
            -   [ ] Subtask 1.3: Implement segmented button groups for "Energy Level" (e.g., Low, Medium, High) as per Flow 6, Screen 1 of UX design.
            -   [ ] Subtask 1.4: Implement an input mechanism for "Soreness" or other qualitative feedback, if not covered by mood/energy.
            -   [ ] Subtask 1.5: Integrate the "Context Window" component into the Dashboard UI (`apps/web/src/app/dashboard/page.tsx`), making it accessible (e.g., via a button click).
        -   [ ] **Task 2: Handle Context Submission (AC2.2.2)**
            -   [ ] Subtask 2.1: Implement state management (Zustand) within the Context Window to capture user selections for mood, energy, and soreness.
            -   [ ] Subtask 2.2: Create a function in `apps/web/src/lib/api.ts` to construct the request payload and call the `POST /plans/generate` endpoint.
            -   [ ] Subtask 2.3: Implement the `[ Generate Today's Plan ]` button to collect user input and call the API function.
            -   [ ] Subtask 2.4: Handle loading states and potential API errors during submission.
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC2.2.1">A "Context Window" UI is available on the dashboard for the user to input mood, energy, and soreness, visually aligned with Flow 6, Screen 1 of the UX design.</criterion>
    <criterion id="AC2.2.2">Submitting the context via the `[ Generate Today's Plan ]` button triggers a call to the `POST /plans/generate` endpoint with the collected mood, energy, and soreness data.</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture</title>
        <section>Novel Architectural Patterns</section>
        <snippet>Pattern: Adaptive Workout Dialogue - describes the conversational loop between the user and the AI.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-2.md</path>
        <title>Epic Technical Specification: AI-Powered Training & Logging</title>
        <section>Story 2.2: Daily Plan Context Window</section>
        <snippet>Details of ACs and overview for Story 2.2.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Phase 1</title>
        <section>Flow 6: Generate AI Daily Plan</section>
        <snippet>Details for Flow 6, Screen 1 (Context Window) UI.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>apps/web/src/components/ContextWindow.tsx</path>
        <kind>ui-component</kind>
        <symbol>ContextWindow</symbol>
        <lines>N/A</lines>
        <reason>New React component for the Context Window.</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/app/dashboard/page.tsx</path>
        <kind>page</kind>
        <symbol>DashboardPage</symbol>
        <lines>N/A</lines>
        <reason>Integration point for the Context Window component.</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/lib/api.ts</path>
        <kind>api-client</kind>
        <symbol>generatePlan</symbol>
        <lines>N/A</lines>
        <reason>Function to call the POST /plans/generate API endpoint.</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/store/context.ts</path>
        <kind>state-management</kind>
        <symbol>useContextStore</symbol>
        <lines>N/A</lines>
        <reason>Zustand store to manage context-related state.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="Node.js">
        <package name="react" version="^18.x" />
        <package name="zustand" version="^4.x" />
        <package name="next" version="^14.x" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>UI must adhere to Flow 6, Screen 1 visual specifications.</constraint>
    <constraint>Data submission must be authenticated with a valid JWT.</constraint>
    <constraint>Frontend must handle loading and error states gracefully.</constraint>
    <constraint>Context data (mood, energy, soreness) must be collected before calling the API.</constraint>
  </constraints>
  <interfaces></interfaces>
  <tests>
    <standards>
      Unit tests for ContextWindow React component (rendering, state changes, button clicks).
      Integration tests to ensure the "Generate Today's Plan" button correctly dispatches the API call with the collected context.
      Test files co-located where appropriate (e.g., `apps/web/tests/components/` or `apps/web/tests/lib/`).
    </standards>
    <locations>
      <location>apps/web/tests/components/ContextWindow.test.tsx</location>
      <location>apps/web/tests/lib/api.test.ts</location>
    </locations>
    <ideas>
      <idea>Test rendering of Mood and Energy segmented buttons with correct labels and icons.</idea>
      <idea>Test user selection of Mood and Energy updates internal component state correctly.</idea>
      <idea>Test "Generate Today's Plan" button click triggers API call with correct payload.</idea>
      <idea>Test loading state is displayed while waiting for API response.</idea>
      <idea>Test error message is displayed if API call fails.</idea>
      <idea>Test Context Window disappears/closes on successful submission or cancellation.</idea>
    </ideas>
  </tests>
</story-context>