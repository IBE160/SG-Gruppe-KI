<story-context id="4-4-general-appearance-settings" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>4</storyId>
    <title>General & Appearance Settings</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-15</generatedAt>
    <generator>BMAD Story Context Workflow (Regenerated)</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-4-General & Appearance Settings.md</sourceStoryPath>
  </metadata>
  <story>
    <asA>user</asA>
    <iWant>to customize general application preferences like language and appearance (theme, accent color, font size)</iWant>
    <soThat>I can personalize my app experience.</soThat>
    <tasks>
      - Frontend (apps/web):
        - UI Implementation (Flow 18, Screen 2): Create React components for the "General" settings sub-screen.
        - UI Implementation (Flow 18, Screen 3): Create React components for the "Appearance" settings sub-screen.
        - State Management (Zustand): Implement Zustand stores to manage and persist theme, language, font size, and notification preferences.
        - Persistence: Integrate with local storage or Supabase `Users` table to persist user preferences.
        - Live Preview: Implement logic to immediately reflect appearance changes in a live preview.
        - Testing: Write unit tests, integration tests, and Playwright E2E tests.
      - Refinement: Ensure UI adheres to `ux_design_content` principles, implement structured JSON logging, verify consistency with naming conventions.
    </tasks>
  </story>
  <acceptanceCriteria>
    <criterion>AC4.4.1: The "General" settings sub-screen is accessible and allows language selection and notification preference toggles.</criterion>
    <criterion>AC4.4.2: The "Appearance" settings sub-screen is accessible and allows theme selection, accent color picking, and font size adjustment.</criterion>
    <criterion>AC4.4.3: Changes to language, theme, accent color, and font size are immediately reflected in the app's UI.</criterion>
    <criterion>AC4.4.4: User preferences are persisted across sessions (local storage or Supabase `Users` table).</criterion>
  </acceptanceCriteria>
  <artifacts>
    <docs>
        <doc>
            <path>docs/architecture.md</path>
            <title>Architecture</title>
            <section>FR Category to Architecture Mapping</section>
            <snippet>Frontend (Next.js `web` app): Responsible for all user-facing features. Handles: Onboarding, Workout Player UI, Dashboard, Settings, User Profile UI, Context Window.</snippet>
        </doc>
        <doc>
            <path>docs/ux-design-direction.md</path>
            <title>UX Design Direction</title>
            <section>Flow 18: Change Settings (General, Health, Playback & Privacy)</section>
            <snippet>The "General" settings sub-screen is detailed in Flow 18, Screen 2 - `genreralsettings/code.html`, and the "Appearance" settings sub-screen is detailed in Flow 18, Screen 3 - `apperance/code.html`.</snippet>
        </doc>
    </docs>
    <code>
      <!-- No existing code artifacts found relevant to this story. -->
    </code>
  </artifacts>
  <constraints>
    <constraint>Frontend must manage client-side state for theme, language, and font preferences using Zustand.</constraint>
    <constraint>User preferences should be persisted across sessions.</constraint>
  </constraints>
  <interfaces>
      <interface>
        <name>Settings Persistence</name>
        <kind>State Management/Data Persistence</kind>
        <signature>Zustand store for settings, integrated with local storage or Supabase `Users` table.</signature>
        <path>apps/web/src/store/settings.ts (to be created)</path>
      </interface>
  </interfaces>
  <tests>
      <standards>Unit tests for components and Zustand stores; integration tests for persistence; E2E tests for customization flows.</standards>
      <locations><location>apps/web/src/app/settings/</location></locations>
      <ideas>
          <idea>Unit test settings components to verify UI rendering and interaction.</idea>
          <idea>E2E test the full flow of customizing general and appearance settings and verifying persistence.</idea>
      </ideas>
  </tests>
</story-context>