<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>2.8</storyId>
    <title>Weekly Review Ritual</title>
    <status>drafted</status>
    <generatedAt>2025-11-24</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-8-weekly-review-ritual.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>User</asA>
    <iWant>to receive an automated weekly summary of my progress</iWant>
    <soThat>I can stay motivated and see my achievements</soThat>
    <tasks>
      - [ ] **Task 1: Backend Service for Weekly Review** (AC: #1)
        - [ ] Create a `Weekly Review Service` that aggregates a user's workout data for the week from the `workout_logs` table. (Source: `tech-spec-epic-2.md#Services-and-Modules`)
        - [ ] Implement logic to identify progress, Personal Records (PRs), and other highlights.
        - [ ] Implement a mechanism to store or deliver the generated summary (e.g., as a new table `weekly_summaries`, or as a notification).
      - [ ] **Task 2: Background Job for Weekly Review** (AC: #1)
        - [ ] Create a scheduled background job using Celery that triggers the `Weekly Review Service` at the end of each week. (Source: `architecture.md#Background-Job-Processing`)
        - [ ] Configure Celery with Redis as the broker.
      - [ ] **Task 3: Testing** (AC: #1)
        - [ ] Add Pytest unit tests for the `Weekly Review Service` logic.
        - [ ] Add Pytest integration tests for the Celery task, ensuring it runs as scheduled and generates the correct summary.
    </tasks>
  </story>

  <acceptanceCriteria>
    1.  **Given** a user has completed workouts during the week, **when** the week ends, **then** an automated summary is generated showing their progress, PRs, and other highlights.
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>ibe160 - Epic Breakdown</title>
        <section>Story 2.8: Weekly Review Ritual</section>
        <snippet>As a User, I want to receive an automated weekly summary of my progress, so that I can stay motivated and see my achievements.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-2.md</path>
        <title>Epic Technical Specification: AI-Powered Training &amp; Logging</title>
        <section>Services and Modules</section>
        <snippet>Weekly Review Service (`app/services/weekly_review_service.py`): Background task (Celery) to generate automated weekly summaries.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Background Job Processing</section>
        <snippet>Celery with Redis will be leveraged for asynchronous tasks, particularly the automated Weekly Review Ritual.</snippet>
      </doc>
    </docs>
    <code>
      <code-artifact>
        <path>backend/app/services/weekly_review_service.py</path>
        <kind>service</kind>
        <symbol>WeeklyReviewService</symbol>
        <lines></lines>
        <reason>This new service will contain the logic for generating weekly summaries.</reason>
      </code-artifact>
      <code-artifact>
        <path>backend/app/tasks/weekly_review.py</path>
        <kind>task</kind>
        <symbol>run_weekly_review</symbol>
        <lines></lines>
        <reason>This new file will contain the Celery task for the weekly review.</reason>
      </code-artifact>
    </code>
    <dependencies>
      <ecosystem name="Python">
        <dependency name="celery" version="" type="runtime" />
        <dependency name="redis" version="" type="runtime" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Must use Celery and Redis for background job processing.</constraint>
    <constraint>The weekly summary should be comprehensive and engaging.</constraint>
  </constraints>
  <interfaces>
  </interfaces>
  <tests>
    <standards>
      Backend unit and integration tests should be written with Pytest.
    </standards>
    <locations>
      <location type="Backend">/backend/tests/</location>
    </locations>
    <ideas>
      <idea ac_id="1">Write a unit test for the `Weekly Review Service` aggregation logic.</idea>
      <idea ac_id="1">Write an integration test for the `run_weekly_review` Celery task.</idea>
    </ideas>
  </tests>
</story-context>
