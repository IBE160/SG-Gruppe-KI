<story-context id="4-5-ai-personalization-settings" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>5</storyId>
    <title>AI & Personalization Settings</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-15</generatedAt>
    <generator>BMAD Story Context Workflow (Regenerated)</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-5-AI & Personalization Settings.md</sourceStoryPath>
  </metadata>
  <story>
    <asA>user</asA>
    <iWant>to understand and manage how the AI learns from my interactions, including viewing and resetting learned preferences and constraints</iWant>
    <soThat>I can have transparent control over my personalized experience.</soThat>
    <tasks>
      - Frontend (apps/web):
        - UI Implementation (Flow 18, Screen 4): Create React components for the "AI & Personalization" settings sub-screen.
        - API Integration: Implement client-side API calls to the FastAPI backend for viewing, editing, deleting, and resetting AI learned preferences.
        - Testing: Write unit tests, integration tests, and Playwright E2E tests.
      - Backend (apps/api):
        - API Endpoints: Create API endpoints to store, retrieve, edit, delete, and reset AI learned preferences.
        - Data Persistence: Implement logic to store, retrieve, and manage AI learned preferences in Supabase.
        - Robust Handling: Ensure robust handling of deleting AI memory and resetting preferences.
        - Testing: Write unit tests and integration tests.
      - Refinement: Ensure API communication adheres to standard format, implement structured JSON logging, verify consistency with naming conventions.
    </tasks>
  </story>
  <acceptanceCriteria>
    <criterion>AC4.5.1: The "AI & Personalization" settings sub-screen is accessible.</criterion>
    <criterion>AC4.5.2: "Learned Preferences" and "Learned Constraints" lists are displayed, showing AI rules.</criterion>
    <criterion>AC4.5.3: Tapping "[ Edit ]" or "[ Delete ]" on a preference/constraint allows modification or removal.</criterion>
    <criterion>AC4.5.4: Tapping "[ Reset All AI Learning ]" with confirmation clears all learned AI preferences and constraints.</criterion>
  </acceptanceCriteria>
  <artifacts>
    <docs>
        <doc>
            <path>docs/architecture.md</path>
            <title>Architecture</title>
            <section>FR Category to Architecture Mapping</section>
            <snippet>Backend (FastAPI `api` app): Responsible for all business logic, data processing, and AI integration. Handles: AI Daily-Plan Generation, Workout Log storage/retrieval, User Authentication logic, Spotify API communication.</snippet>
        </doc>
        <doc>
            <path>docs/ux-design-direction.md</path>
            <title>UX Design Direction</title>
            <section>Flow 18: Change Settings (General, Health, Playback & Privacy)</section>
            <snippet>The "AI & Personalization" settings sub-screen is detailed in Flow 18, Screen 4 - `ai/code.html`.</snippet>
        </doc>
    </docs>
    <code>
      <!-- No existing code artifacts found relevant to this story. -->
    </code>
  </artifacts>
  <constraints>
    <constraint>Frontend must clearly display AI learned preferences and constraints.</constraint>
    <constraint>Backend must provide robust API endpoints for managing AI preferences, including viewing, editing, deleting, and resetting.</constraint>
  </constraints>
  <interfaces>
      <interface>
        <name>AI Preferences API</name>
        <kind>REST Endpoint</kind>
        <signature>GET /user-preferences/ai</signature>
        <path>apps/api/app/api/ai_preferences.py</path>
      </interface>
  </interfaces>
  <tests>
      <standards>Unit tests for components and interaction logic; integration tests for API calls; E2E tests for viewing, editing, deleting, and resetting AI preferences.</standards>
      <locations><location>apps/web/src/app/settings/ai/</location></locations>
      <ideas>
          <idea>E2E test viewing the list of learned AI preferences and constraints.</idea>
          <idea>E2E test the process of resetting all AI learning, including confirmation.</idea>
      </ideas>
  </tests>
</story-context>