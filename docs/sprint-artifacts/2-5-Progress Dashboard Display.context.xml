<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>5</storyId>
    <title>Progress Dashboard Display</title>
    <status>drafted</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>C:\Users\Administrator\SG-Gruppe-KI\docs\sprint-artifacts\2-5-Progress Dashboard Display.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>to view a personalized dashboard with key metrics, progress visualizations, and a weekly review summary</iWant>
    <soThat>I can monitor my performance and understand my progress over time.</soThat>
    <tasks>
      <task category="Task 1: Implement Dashboard UI Shell &amp; Navigation (AC: 1, 8)">
        <description>Subtask 1.1: Create `apps/web/src/app/dashboard/page.tsx` for the main Dashboard UI.</description>
        <status>pending</status>
      </task>
      <task category="Task 1: Implement Dashboard UI Shell &amp; Navigation (AC: 1, 8)">
        <description>Subtask 1.2: Implement navigation to the dashboard after login or confirmed plan.</description>
        <status>pending</status>
      </task>
      <task category="Task 1: Implement Dashboard UI Shell &amp; Navigation (AC: 1, 8)">
        <description>Subtask 1.3: Implement the overall layout and structure for displaying various metrics and sections.</description>
        <status>pending</status>
      </task>
      <task category="Task 1: Implement Dashboard UI Shell &amp; Navigation (AC: 1, 8)">
        <description>Subtask 1.4: Write unit tests (Jest/RTL) for the dashboard shell and navigation.</description>
        <status>pending</status>
      </task>
      <task category="Task 2: Implement Key Metrics Display (AC: 2, 3, 4, 8)">
        <description>Subtask 2.1: Create components to display total workout volume and workout streaks (e.g., `apps/web/src/components/Dashboard/MetricsDisplay.tsx`).</description>
        <status>pending</status>
      </task>
      <task category="Task 2: Implement Key Metrics Display (AC: 2, 3, 4, 8)">
        <description>Subtask 2.2: Implement data fetching logic using `GET /dashboard` API endpoint.</description>
        <status>pending</status>
      </task>
      <task category="Task 2: Implement Key Metrics Display (AC: 2, 3, 4, 8)">
        <description>Subtask 2.3: Integrate with a new Zustand store (`apps/web/src/store/dashboardStore.ts`) to manage dashboard data.</description>
        <status>pending</status>
      </task>
      <task category="Task 2: Implement Key Metrics Display (AC: 2, 3, 4, 8)">
        <description>Subtask 2.4: Implement basic progress visualizations (e.g., simple charts or graphs).</description>
        <status>pending</status>
      </task>
      <task category="Task 2: Implement Key Metrics Display (AC: 2, 3, 4, 8)">
        <description>Subtask 2.5: Write unit tests (Jest/RTL) for metrics display components and data fetching.</description>
        <status>pending</status>
      </task>
      <task category="Task 3: Implement Weekly Review Section (AC: 5, 6)">
        <description>Subtask 3.1: Create a component for the "Weekly Review" section (e.g., `apps/web/src/components/Dashboard/WeeklyReview.tsx`).</description>
        <status>pending</status>
      </task>
      <task category="Task 3: Implement Weekly Review Section (AC: 5, 6)">
        <description>Subtask 3.2: Implement UI to display a summary of weekly progress and AI-generated insights.</description>
        <status>pending</status>
      </task>
      <task category="Task 3: Implement Weekly Review Section (AC: 5, 6)">
        <description>Subtask 3.3: Fetch weekly review data from `GET /dashboard`.</description>
        <status>pending</status>
      </task>
      <task category="Task 3: Implement Weekly Review Section (AC: 5, 6)">
        <description>Subtask 3.4: Write unit tests (Jest/RTL) for the Weekly Review component.</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.1: Create Pydantic models for the dashboard response (aggregated metrics, weekly review summary).</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.2: Create `apps/api/app/api/dashboard.py` and define a FastAPI router.</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.3: Implement the `GET /dashboard` endpoint, protecting it with authentication.</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.4: Create `apps/api/app/services/dashboard_service.py` to handle aggregating data from `WorkoutLogs` and other relevant tables.</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.5: Update `apps/api/main.py` to include the new `dashboard` router.</description>
        <status>pending</status>
      </task>
      <task category="Task 4: Implement Backend `GET /dashboard` API Endpoint (AC: 7, 8)">
        <description>Subtask 4.6: Write integration tests (Pytest) for the `GET /dashboard` endpoint, mocking Supabase interactions. (Prioritize resolving `ModuleNotFoundError` tech debt).</description>
        <status>pending</status>
      </task>
      <task category="Task 5: E2E Testing">
        <description>Subtask 5.1: Write an E2E test (Playwright) that simulates a user completing several workouts, then navigates to the dashboard and verifies that key metrics and the weekly review are displayed accurately.</description>
        <status>pending</status>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">The Dashboard UI is accessible to authenticated users.</criterion>
    <criterion id="2">The Dashboard displays key metrics such as total workout volume (e.g., total weight lifted, total reps), calculated from `WorkoutLogs` data.</criterion>
    <criterion id="3">The Dashboard displays workout streaks (e.g., consecutive days/weeks of training), calculated from `WorkoutLogs` data.</criterion>
    <criterion id="4">The Dashboard presents progress visualizations (e.g., charts for volume over time) based on `WorkoutLogs` data.</criterion>
    <criterion id="5">A dedicated "Weekly Review" section is present, summarizing the user's progress for the week.</criterion>
    <criterion id="6">The "Weekly Review" section includes AI-generated insights and suggestions for the upcoming week.</criterion>
    <criterion id="7">The `GET /dashboard` API endpoint successfully returns aggregated metrics and weekly review data.</criterion>
    <criterion id="8">Displayed dashboard data accurately reflects `WorkoutLogs` data within a tolerance of Â±1%.</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (Frontend Framework)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | Framework | Next.js (with App Router) | | All frontend features | Provides a best-in-class React framework with SSR, SSG, and a strong ecosystem. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (State Management)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | State Management | Zustand | 5.0.9 | All interactive frontend features | A lightweight, simple, and powerful state management solution that is easy to learn and integrates well with React/Next.js. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (Data Persistence)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | Data Persistence | Supabase (PostgreSQL) | 2.86.0 | All data-related features | Provides a managed PostgreSQL database, simplifying setup and scaling. Also includes Auth and Storage. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Backend (FastAPI) handling Workout Log</title>
        <section>FR Category to Architecture Mapping</section>
        <snippet>
          -   **Backend (FastAPI `api` app):** Responsible for all business logic, data processing, and AI integration.
              -   Handles: AI Daily-Plan Generation, Workout Log storage/retrieval, User Authentication logic, Spotify API communication.
              -   Interacts directly with the Supabase (PostgreSQL) database.
              -   Provides the REST API for the frontend.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Security Architecture (RLS)</title>
        <section>Security Architecture</section>
        <snippet>
          -   **Authorization:** Row Level Security (RLS) will be enabled in PostgreSQL to ensure users can only access their own data.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14: View Dashboard & Weekly Review</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          ### **Flow 14: View Dashboard & Weekly Review**

          *   **Purpose:** Offer a personalized, motivating, and interactive overview of training progress and adherence.
          *   **Core User Journey:** User lands on a customizable dashboard with key metrics, goal progress, and recent activity. Can explore detailed trends and receive AI-driven adjustments.
          *   **Key UX Direction:** Customizable Dashboard Widgets (users personalize layout), Interactive Data Exploration (drill down into charts/data), Goal Progress Visualization, "Celebrate Wins" Section.
          *   The UI for the Dashboard should be based on `Flow 14, Screen 1 - screen_1/code.html` and the Weekly Review on `Flow 14, Screen 2 - screen_2/code.html` from `ux_design_content`.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14, Screen 1 (Dashboard UI)</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          When I navigate to the Dashboard (Flow 14, Screen 1 - `screen_1/code.html`)
          Then I can see key stats like total volume, intensity, and workout streaks
          And I can see "Celebrate Your Wins" for PRs and milestones
          And the dashboard contains customizable widgets (though customization implemented in Flow 14, Screen 3 - `screen_3/code.html` is optional for this story)
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14, Screen 2 (Weekly Review)</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          And I can access a "Weekly Review" (Flow 14, Screen 2 - `screen_2/code.html`) showing trends and AI-generated insights (FR011)
        </snippet>
      </artifact>
      <artifact>
        <path>docs/epics.md</path>
        <title>Epic 2, Story 2.5: Progress Dashboard Display</title>
        <section>Epic 2: AI-Powered Training & Logging</section>
        <snippet>
          ### Story 2.5: Progress Dashboard Display
          As a user,
          I want to view a personalized dashboard with key metrics, progress visualizations, and a weekly review summary,
          So that I can monitor my performance and understand my progress over time.

          **Acceptance Criteria:**
          *   **AC2.5.1:** The dashboard displays key metrics like total workout volume and workout streaks based on data from `WorkoutLogs`.
          *   **AC2.5.2:** A "Weekly Review" section shows trends and AI-generated insights.

          **Prerequisites:** Story 2.4

          **Technical Notes:** Implement frontend UI for Dashboard and Weekly Review based on `ux_design_content` (Flow 14 `code.html` files). Retrieve aggregated data from Supabase `WorkoutLogs` via FastAPI endpoints. Ensure performance metrics for data retrieval (`NFR004`).
        </snippet>
      </artifact>
    </docs>
  <artifacts>
    <docs>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (Frontend Framework)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | Framework | Next.js (with App Router) | | All frontend features | Provides a best-in-class React framework with SSR, SSG, and a strong ecosystem. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (State Management)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | State Management | Zustand | 5.0.9 | All interactive frontend features | A lightweight, simple, and powerful state management solution that is easy to learn and integrates well with React/Next.js. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Decision Summary (Data Persistence)</title>
        <section>Decision Summary</section>
        <snippet>
          | Category | Decision | Version | Affects Epics | Rationale |
          | -------- | -------- | ------- | ------------- | --------- |
          | Data Persistence | Supabase (PostgreSQL) | 2.86.0 | All data-related features | Provides a managed PostgreSQL database, simplifying setup and scaling. Also includes Auth and Storage. |
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Backend (FastAPI) handling Workout Log</title>
        <section>FR Category to Architecture Mapping</section>
        <snippet>
          -   **Backend (FastAPI `api` app):** Responsible for all business logic, data processing, and AI integration.
              -   Handles: AI Daily-Plan Generation, Workout Log storage/retrieval, User Authentication logic, Spotify API communication.
              -   Interacts directly with the Supabase (PostgreSQL) database.
              -   Provides the REST API for the frontend.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/architecture.md</path>
        <title>Architecture - Security Architecture (RLS)</title>
        <section>Security Architecture</section>
        <snippet>
          -   **Authorization:** Row Level Security (RLS) will be enabled in PostgreSQL to ensure users can only access their own data.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14: View Dashboard & Weekly Review</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          ### **Flow 14: View Dashboard & Weekly Review**

          *   **Purpose:** Offer a personalized, motivating, and interactive overview of training progress and adherence.
          *   **Core User Journey:** User lands on a customizable dashboard with key metrics, goal progress, and recent activity. Can explore detailed trends and receive AI-driven adjustments.
          *   **Key UX Direction:** Customizable Dashboard Widgets (users personalize layout), Interactive Data Exploration (drill down into charts/data), Goal Progress Visualization, "Celebrate Wins" Section.
          *   The UI for the Dashboard should be based on `Flow 14, Screen 1 - screen_1/code.html` and the Weekly Review on `Flow 14, Screen 2 - screen_2/code.html` from `ux_design_content`.
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14, Screen 1 (Dashboard UI)</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          When I navigate to the Dashboard (Flow 14, Screen 1 - `screen_1/code.html`)
          Then I can see key stats like total volume, intensity, and workout streaks
          And I can see "Celebrate Your Wins" for PRs and milestones
          And the dashboard contains customizable widgets (though customization implemented in Flow 14, Screen 3 - `screen_3/code.html` is optional for this story)
        </snippet>
      </artifact>
      <artifact>
        <path>docs/ux-design-direction.md</path>
        <title>UX Design Direction - Flow 14, Screen 2 (Weekly Review)</title>
        <section>Flow 14: View Dashboard & Weekly Review</section>
        <snippet>
          And I can access a "Weekly Review" (Flow 14, Screen 2 - `screen_2/code.html`) showing trends and AI-generated insights (FR011)
        </snippet>
      </artifact>
      <artifact>
        <path>docs/epics.md</path>
        <title>Epic 2, Story 2.5: Progress Dashboard Display</title>
        <section>Epic 2: AI-Powered Training & Logging</section>
        <snippet>
          ### Story 2.5: Progress Dashboard Display
          As a user,
          I want to view a personalized dashboard with key metrics, progress visualizations, and a weekly review summary,
          So that I can monitor my performance and understand my progress over time.

          **Acceptance Criteria:**
          *   **AC2.5.1:** The dashboard displays key metrics like total workout volume and workout streaks based on data from `WorkoutLogs`.
          *   **AC2.5.2:** A "Weekly Review" section shows trends and AI-generated insights.

          **Prerequisites:** Story 2.4

          **Technical Notes:** Implement frontend UI for Dashboard and Weekly Review based on `ux_design_content` (Flow 14 `code.html` files). Retrieve aggregated data from Supabase `WorkoutLogs` via FastAPI endpoints. Ensure performance metrics for data retrieval (`NFR004`).
        </snippet>
      </artifact>
    </docs>
    <code>
      <artifact>
        <path>apps/web/src/app/dashboard/page.tsx</path>
        <kind>UI Page</kind>
        <symbol>DashboardPage</symbol>
        <lines></lines>
        <reason>Main Dashboard UI</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/components/Dashboard/MetricsDisplay.tsx</path>
        <kind>UI Component</kind>
        <symbol>MetricsDisplay</symbol>
        <lines></lines>
        <reason>Component to display total workout volume and workout streaks</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/store/dashboardStore.ts</path>
        <kind>Zustand Store</kind>
        <symbol>dashboardStore</symbol>
        <lines></lines>
        <reason>Manages the state for dashboard data</reason>
      </artifact>
      <artifact>
        <path>apps/web/src/components/Dashboard/WeeklyReview.tsx</path>
        <kind>UI Component</kind>
        <symbol>WeeklyReview</symbol>
        <lines></lines>
        <reason>Component for the "Weekly Review" section</reason>
      </artifact>
      <artifact>
        <path>apps/api/app/api/dashboard.py</path>
        <kind>FastAPI Router</kind>
        <symbol>GET /dashboard</symbol>
        <lines></lines>
        <reason>Endpoint to provide aggregated data and insights for the dashboard</reason>
      </artifact>
      <artifact>
        <path>apps/api/app/services/dashboard_service.py</path>
        <kind>Dashboard Service</kind>
        <symbol>DashboardService</symbol>
        <lines></lines>
        <reason>Handles aggregating data from `WorkoutLogs`</reason>
      </artifact>
    </code>
    <dependencies>
      <dependency>
        <name>Next.js</name>
        <version></version>
        <ecosystem>JS/TS</ecosystem>
      </dependency>
      <dependency>
        <name>Zustand</name>
        <version>5.0.9</version>
        <ecosystem>JS/TS</ecosystem>
      </dependency>
      <dependency>
        <name>Jest</name>
        <version>30.2.0</version>
        <ecosystem>JS/TS</ecosystem>
      </dependency>
      <dependency>
        <name>React Testing Library</name>
        <version>16.3.0</version>
        <ecosystem>JS/TS</ecosystem>
      </dependency>
      <dependency>
        <name>Playwright</name>
        <version>1.57.0</version>
        <ecosystem>JS/TS</ecosystem>
      </dependency>
      <dependency>
        <name>FastAPI</name>
        <version>0.123.7</version>
        <ecosystem>Python</ecosystem>
      </dependency>
      <dependency>
        <name>Supabase (PostgreSQL)</name>
        <version>2.86.0</version>
        <ecosystem>Database</ecosystem>
      </dependency>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Data Aggregation Logic: `dashboard_service` will require careful implementation of aggregation queries.</constraint>
    <constraint>Performance: Dashboard data fetching should be optimized; consider caching strategies.</constraint>
    <constraint>UX/UI Visualizations: Initial implementation with simple visualizations; advanced charts can be separate.</constraint>
    <constraint>AI Insights: Weekly Review insights will likely come from backend (AI Orchestrator service).</constraint>
    <constraint>Backend testing issue persists; prioritize comprehensive frontend unit tests and E2E tests.</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>Dashboard API</name>
      <kind>REST endpoint</kind>
      <signature>GET /dashboard</signature>
      <path>apps/api/app/api/dashboard.py</path>
    </interface>
    <interface>
      <name>Supabase WorkoutLogs Table</name>
      <kind>Database Table</kind>
      <signature>Workout log entries</signature>
      <path></path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Frontend: Unit tests for components, data fetching, data aggregation logic, Zustand store. E2E tests for dashboard display.
      Backend: Integration tests for `GET /dashboard` endpoint.
    </standards>
    <locations>
      <location>apps/web/tests</location>
      <location>apps/api/tests</location>
    </locations>
    <ideas>
      <idea>Unit test dashboard components for displaying metrics and visualizations correctly.</idea>
      <idea>Unit test `dashboardStore` for state management of dashboard data.</idea>
      <idea>Integration test data fetching from `GET /dashboard` endpoint.</idea>
      <idea>E2E test the full user journey of navigating to the dashboard and verifying accurate display of metrics and weekly review.</idea>
      <idea>Integration test backend `GET /dashboard` endpoint for correct data aggregation and RLS application.</idea>
    </ideas>
  </tests>
</story-context>
