<story-context id="4-3-privacy-account-management" v="1.0">
  <metadata>
    <epicId>4</epicId>
    <storyId>3</storyId>
    <title>Privacy & Account Management</title>
    <status>ready-for-dev</status>
    <generatedAt>2025-12-15</generatedAt>
    <generator>BMAD Story Context Workflow (Regenerated)</generator>
    <sourceStoryPath>docs/sprint-artifacts/4-3-Privacy & Account Management.md</sourceStoryPath>
  </metadata>
  <story>
    <asA>user</asA>
    <iWant>full control over my privacy settings, including data export and account deletion</iWant>
    <soThat>I can manage my personal information in compliance with GDPR.</soThat>
    <tasks>
      - Frontend (apps/web):
        - UI Implementation (Flow 18, Screen 5): Create React components for the "Privacy & Account" settings sub-screen.
        - UI Implementation (Flow 15, Screen 1-2): Create React components for the "Export Data Information & Request" flow.
        - UI Implementation (Flow 16, Screen 1-4): Create React components for the "Delete My Account" flow.
        - API Integration: Implement client-side API calls to the FastAPI backend for data export, account deletion, and logout.
        - Testing: Write unit tests, integration tests, and Playwright E2E tests.
      - Backend (apps/api):
        - API Endpoints: Implement `/export` endpoint and `/auth/user` endpoint for account deletion.
        - Supabase Integration: Ensure secure integration with Supabase for data operations and authentication.
        - GDPR Compliance: Implement logic to ensure data export and deletion adhere to GDPR requirements.
        - Testing: Write unit tests and integration tests.
      - Refinement: Ensure API communication adheres to standard format, implement structured JSON logging, verify consistency with naming conventions.
    </tasks>
  </story>
  <acceptanceCriteria>
    <criterion>AC4.3.1: The "Privacy & Account" settings sub-screen is accessible.</criterion>
    <criterion>AC4.3.2: Tapping "[ Export My Data ]" navigates to the data export flow, allowing GDPR-compliant data export.</criterion>
    <criterion>AC4.3.3: Tapping "[ Delete My Account ]" initiates the account deletion flow, requiring explicit confirmation and ensuring permanent removal as per GDPR.</criterion>
    <criterion>AC4.3.4: Tapping "[ Logout ]" securely logs the user out of the application.</criterion>
  </acceptanceCriteria>
  <artifacts>
    <docs>
        <doc>
            <path>docs/architecture.md</path>
            <title>Architecture</title>
            <section>Security Architecture</section>
            <snippet>Emphasis on GDPR compliance, secure handling of user data, and Pydantic validation for API endpoints.</snippet>
        </doc>
        <doc>
            <path>docs/ux-design-direction.md</path>
            <title>UX Design Direction</title>
            <section>Flow 18: Change Settings (General, Health, Playback & Privacy)</section>
            <snippet>The "Privacy & Account" settings sub-screen is detailed in Flow 18, Screen 5 - `privacy/code.html`.</snippet>
        </doc>
    </docs>
    <code>
      <!-- No existing code artifacts found relevant to this story. -->
    </code>
  </artifacts>
  <constraints>
    <constraint>GDPR compliance is paramount for data export and account deletion processes.</constraint>
    <constraint>Account deletion must be irreversible and remove all associated user data.</constraint>
  </constraints>
  <interfaces>
      <interface>
        <name>Data Export API</name>
        <kind>REST Endpoint</kind>
        <signature>GET /export</signature>
        <path>apps/api/app/api/export.py</path>
      </interface>
      <interface>
        <name>Account Deletion API</name>
        <kind>REST Endpoint</kind>
        <signature>DELETE /auth/user</signature>
        <path>apps/api/app/api/auth.py</path>
      </interface>
  </interfaces>
  <tests>
      <standards>Unit tests for components and confirmation flows; integration tests for API calls and Supabase Auth; E2E tests for data export, account deletion, and logout user journeys.</standards>
      <locations><location>apps/web/src/app/settings/privacy/</location></locations>
      <ideas>
          <idea>E2E test the full data export flow, including request, confirmation, and data delivery.</idea>
          <idea>E2E test the account deletion flow, verifying warnings, explicit confirmation, and permanent data removal.</idea>
      </ideas>
  </tests>
</story-context>